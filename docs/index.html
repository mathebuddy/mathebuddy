<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <!--<meta
      http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests"
    />-->
    <title>mathe:buddy</title>
    <!--<link rel="stylesheet" href="Skeleton-2.0.4/css/normalize.css" />-->
    <link rel="stylesheet" href="Skeleton-2.0.4/css/skeleton.css?v=4" />

    <style>
      pre code {
        white-space: pre-wrap;
      }
      /*TODO: add to skeleton.css*/
      .tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted black;
      }
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        max-height: 32px;
        background-color: rgb(255, 255, 255);
        color: #000000;
        text-align: center;
        border-radius: 30px;
        border-style: solid;
        border-width: 2px;
        border-color: #000000;
        padding: 0px 0;
        position: absolute;
        z-index: 1;
        top: 85%;
        left: 50%;
        margin-left: -60px;
        opacity: 0.85;
        text-transform: none;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
      }
      .milestone-green {
        background-color: #4ba645;
        color: white;
        font-size: large;
        border-radius: 30px;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .milestone-red {
        background-color: #aa322c;
        color: white;
        font-size: large;
        border-radius: 30px;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .milestone-done {
        font-size: large;
        padding-top: 10px;
        padding-bottom: 10px;
        text-align: right;
        padding-left: 10px;
      }
      .milestone-todo {
        font-size: large;
        border-left-style: solid;
        border-left-color: #000000;
        border-left-width: 2px;
        padding-top: 10px;
        padding-bottom: 10px;
        text-align: left;
        padding-left: 10px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <br />
      <div style="text-align: left">
        <span onclick="switchLanguage('de')" style="cursor: pointer"
          ><b>German</b></span
        >
        |
        <span onclick="switchLanguage('en')" style="cursor: pointer"
          ><b>English</b></span
        >
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a
          href="https://github.com/mathebuddy"
          target="_blank"
          style="cursor: pointer"
        >
          <img
            src="img/github/GitHub_Logo.png"
            style="max-height: 26px; vertical-align: middle"
          />
        </a>
        <img
          src="img/app-store/ios.png"
          style="height: 32px; vertical-align: middle"
        />
        <img
          src="img/app-store/android.png"
          style="height: 32px; vertical-align: middle"
        />
        <br />
      </div>

      <span class="text-german">
        <img class="u-max-full-width" src="img/logo/logo-large.svg" />
      </span>
      <span class="text-english">
        <img class="u-max-full-width" src="img/logo/logo-large-en.svg" />
      </span>

      <div class="row">
        <div style="text-align: center">
          <button class="button-primary" onclick="show('home')">home</button>
          <button class="button-primary" onclick="show('blog')">blog</button>
          <button class="button-primary" onclick="show('doc')">doc</button>
          <button class="button-primary" onclick="show('playground-list')">
            play
          </button>
          <button class="button-primary" onclick="show('sim')">sim</button>
          <button class="button-primary" onclick="show('road')">road</button>
        </div>
        <div id="playground-list" style="text-align: center; display: none">
          <b>PLAYGROUND</b><br />
          <button class="button" onclick="showPlayground('math-runtime')">
            math
          </button>
          <button class="button" onclick="showPlayground('smpl')">SMPL</button>
          <button class="button" onclick="showPlayground('mbl')">MBL</button>
        </div>
        <div id="doc-list" style="text-align: center; display: none">
          <b>DOCUMENTATION</b><br />
          <button class="button" onclick="showDoc('mbl')">MBL</button>
          <button class="button" onclick="showDoc('smpl')">SMPL</button>
          <button class="button" onclick="showDoc('mbcl')">MBCL</button>
          <button class="button" onclick="showDoc('sim')">SIM</button>
        </div>
        <div id="sim-list" style="text-align: center; display: none">
          <b>SIMULATION</b><br />
          <button class="button" onclick="showSim('demo')">demo</button>
          <button class="button" onclick="showSim('localhost')">
            http://localhost:8271
          </button>
        </div>
      </div>
    </div>

    <!-- ===== HOME ===== -->
    <div id="home" class="container" style="display: none">
      <div class="row">
        <br />
        <!--<h2>Home</h2>-->
        <p>
          <span class="text-german">
            Gefördert durch die
            <i
              >Stiftung Innovation in der Hochschullehre;
              <a
                href="https://stiftung-hochschullehre.de/foerderung/freiraum2022/"
                target="_blank"
                >FREIRAUM 2022</a
              >
            </i>
          </span>
          <span class="text-english">
            Funded by
            <i
              >Stiftung Innovation in der Hochschullehre;
              <a
                href="https://stiftung-hochschullehre.de/foerderung/freiraum2022/"
                target="_blank"
                >FREIRAUM 2022</a
              >
            </i>
          </span>
        </p>
        <p style="font-size: large">
          <span class="text-german">
            Die Lernanwendung
            <b><span style="color: #aa322c">mathe:buddy</span></b> ist eine
            interaktive und gamifizierte App für die höhere Mathematik im ersten
            Studienjahr. Studierende werden durch interaktives Training und
            Elemente des spielerischen Lernens motiviert, begleitet und
            individuell gefördert.
          </span>
          <span class="text-english">
            The learning application
            <b><span style="color: #aa322c">mathe:buddy</span></b> is an
            interactive and gamified app for higher mathematics in the first
            year of study. Students are motivated through interactive training
            and elements of game-based learning, motivating, guiding, and
            individually supported.
          </span>
        </p>
        <p style="font-size: large">
          <span class="text-german">
            Jedes Themengebiet wird durch prägnante, gut verständliche Texte
            eingeführt und enthält Beispiele, Abbildungen und Verweise zum
            Praxisbezug. Ein automatisiertes Lernmanagement stellt abhängig vom
            Lernstand randomisierte Trainingsaufgaben unterschiedlicher
            Taxonomiestufen. Die Lernphase wird abgerundet durch kurze Spiele,
            wie zum Beispiel Schnellabfragen, Mathe-Rätsel und
            Formelfehlersuche. Das Erreichen von Meilensteinen wird durch Awards
            und Highscores belohnt. Studierende werden motiviert kontinuierlich
            auf die Lernziele hinzuarbeiten. Ein integrierter Chatbot
            beantwortet einfache Fragen und stellt kurze Trainingsaufgaben. Alle
            Kursbestandteile sind modular aufgebaut und können nichtlinear
            bearbeitet werden.
          </span>
          <span class="text-english">
            Each subject area is introduced by concise, easy-to-understand texts
            and contains examples, illustrations and references for practical
            use. An automated learning management system provides randomized
            training tasks of different taxonomic levels. The learning phase is
            rounded off with short games, such as quick quizzes, math puzzles,
            and formula error search. The achievement of milestones is rewarded
            with awards and high scores. Students are motivated to continuously
            work towards their learning goals. An integrated chatbot answers
            simple questions and poses short training tasks. All course
            components are modular and can be worked on non-linearly.
          </span>
        </p>
        <p style="font-size: large">
          <span class="text-german">
            Das niederschwellige Angebot ermöglicht den Studierenden fachliche
            Lücken eigenständig zu schließen. Mittels eines digitalen
            Zertifikats kann der erreichte Lernstand nachgewiesen werden. Die
            App ist
            <a href="https://github.com/mathebuddy/" target="_blank"
              >Open-Source</a
            >
            , kostenfrei und kann ohne zentrale Datenerhebung genutzt werden.
            Lehrende können selbst einfach Anpassungen und Erweiterung von
            Kursbestandteilen vornehmen.
          </span>
          <span class="text-english">
            The low-threshold offer enables students to close subject-related
            gaps on their own. A digital certificate can be used to prove the
            level of learning achieved. The app is
            <a href="https://github.com/mathebuddy/" target="_blank"
              >Open-Source</a
            >, free of charge and can be used without central data collection.
            Teachers can easily adapt and expand course components themselves.
          </span>
        </p>

        <br />

        <div style="text-align: center">
          <span class="text-german">
            <img
              class="u-max-full-width"
              src="img/timeline/timeline-de.svg?v=2"
            />
          </span>
          <span class="text-english"
            ><img
              class="u-max-full-width"
              src="img/timeline/timeline-en.svg?v=2"
            />
          </span>
        </div>
      </div>
    </div>

    <!-- ===== BLOG ===== -->
    <div id="blog" class="container" style="display: none">
      <div class="row">
        <br />
        <h2>Blog</h2>
        <div id="blog-items"></div>
      </div>
    </div>

    <!-- ===== ROAD ===== -->
    <div id="road" class="container" style="display: none">
      <div class="row" style="text-align: left">
        <br />
        <h2>Roadmap</h2>

        <p style="font-size: large; color: #434343">
          <em>Note: This page only lists technical stuff.</em>
        </p>
      </div>

      <div class="row" style="text-align: center">
        <div class="one-half column offset-by-three milestone-green">
          Project Start 09/2022
        </div>
      </div>
      <div class="row" style="text-align: center; display: flex">
        <div class="one-half column milestone-done">
          <span style="color: gray; font-size: small">DONE</span><br />
          formal language definition<br />
          simulator prototype<br />
        </div>
        <div class="one-half column milestone-todo">
          <span style="color: gray; font-size: small">WIP / TODO</span><br />
          complete math runtime<br />
          complete compiler<br />
          rewrite code with Dart<br />
          flutter simulator<br />
        </div>
      </div>
      <div class="row" style="text-align: center">
        <div class="one-half column offset-by-three milestone-red">
          Release Webapp ~03/2023
        </div>
      </div>
      <div class="row" style="text-align: center">...</div>
      <div class="row" style="text-align: center">
        <div class="one-half column offset-by-three milestone-red">
          Release iOS / Android App ~09/2023
        </div>
      </div>

      <div class="row">
        <div id="road-items"></div>
      </div>
    </div>

    <!-- ===== SIM ===== -->
    <div id="sim-info" class="container" style="display: none">
      <!-- TODO: write and activate this info div -->
      <div class="row" style="font-size: large">
        Simulation can be performed from XXXX
      </div>
    </div>

    <div id="sim" class="container" style="display: none">
      <div class="row">
        <br />
        <h2>Simulator</h2>
        <p id="localhost-error-info" style="font-size: larger; display: none">
          ERROR: You need to run a local webserver on your local computer. Head
          to your course directory and run <code>python3 server.py</code>. Then
          reload this page.
        </p>
        <p id="localhost-error-info" style="font-size: larger; display: none">
          WARNING: The Safari Browser is currently NOT supported.
        </p>

        <!--<div style="text-align: center; color: #aa322c">Simulator</div>-->
        <div id="sim-list" class="row" style="padding: 0px; text-align: left">
          <span
            style="
              color: gray;
              width: 20px;
              display: inline-block;
              text-align: center;
            "
          >
            <img
              src="img/fontawesome/mobile-screen-solid.svg"
              style="height: 12px"
            />
          </span>
          <button
            class="button"
            onclick="setDevice('iPhone5s')"
            style="font-size: 10px"
          >
            iPhone 5s
          </button>
          <button
            class="button"
            onclick="setDevice('iPhone8')"
            style="font-size: 10px"
          >
            iPhone 8
          </button>
          <button
            class="button"
            onclick="setDevice('iPhone14ProMax')"
            style="font-size: 10px"
          >
            iPhone 14 Pro Max
          </button>
        </div>

        <div class="row" style="padding: 0px; text-align: left">
          <span
            style="
              color: gray;
              width: 20px;
              display: inline-block;
              text-align: center;
            "
          >
            <img
              src="img/fontawesome/folder-open-solid.svg"
              style="height: 12px"
            />
          </span>
          <span
            id="sim-path-buttons"
            style="text-align: left; padding: 0"
          ></span>
        </div>

        <div class="row" style="text-align: left">
          <div class="six columns" style="text-align: center">&nbsp;</div>
          <div class="six columns" style="text-align: center">
            <div id="sim-current-path" style="text-align: center; padding: 0" ;>
              <span>(no file selected)</span>
            </div>
          </div>
        </div>
        <div class="row" style="text-align: left">
          <div class="six columns" style="text-align: center">
            <iframe
              id="sim-iframe"
              title="mathe:buddy simulator instance"
              src="poweroff.html"
              style="
                border-style: solid;
                border-color: #434343;
                border-width: 1px;
                border-radius: 25px;
                min-height: 640px;
                height: 640px;
                max-height: 640px;
                width: 360px;
                min-width: 360px;
                max-width: 360px;
                border-width: 2px;
                -moz-box-shadow: 0 0 10px #aaa;
                -webkit-box-shadow: 0 0 10px #aaa;
                box-shadow: 0 0 10px #aaa;
              "
            >
            </iframe>
          </div>
          <div class="six columns">
            <div
              style="
                border-style: solid;
                border-color: #434343;
                border-width: 1px;
                border-radius: 0px;
                padding: 10px;
                border-width: 2px;
                width: 100%;
                min-height: 640px;
                height: 640px;
                max-height: 640px;
                -moz-box-shadow: 0 0 10px #aaa;
                -webkit-box-shadow: 0 0 10px #aaa;
                box-shadow: 0 0 10px #aaa;
                overflow-y: scroll;
              "
            >
              <div style="width: 100%; text-align: center">
                <button type="button" onclick="resetSim();">
                  <img
                    src="img/fontawesome/power-off-solid.svg"
                    style="
                      height: 20px;
                      vertical-align: middle;
                      padding-inline: 0px;
                    "
                  />
                </button>
                <button type="button">MBL</button>
                <button type="button">MBCL</button>
              </div>
              <div id="sim-log-area">Log Area</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== DOC ===== -->
    <div id="doc" class="container" style="display: none">
      <div class="row">
        <br />
        <h2>Documentation</h2>
        <p style="font-size: large">
          The following diagram visually shows all components of the app and the
          environment.
        </p>
        <div
          style="
            border-style: solid;
            border-width: 1px;
            border-color: black;
            border-radius: 10px;
            padding: 10px;
            width: 65%;
          "
        >
          <img
            class="u-max-full-width"
            src="img/misc/mathebuddy-comp-diag.png?v=2"
          />
        </div>
        <br />

        <!-- TODO: math-runtime -->

        <h3>Mathe:Buddy Langauge (MBL)</h3>
        <p style="font-size: large">
          Formal language to expressively define online math courses.
          <a href="doc/mbl.html" target="_blank">Documentation</a>
        </p>

        <h3>Simple Math Programming Language (SMPL)</h3>
        <p style="font-size: large">
          Turing-complete programming language with intrinsic mathematical data
          types.
          <a href="doc/smpl.html" target="_blank">Documentation</a>
        </p>

        <h3>Mathe:Buddy Compiled Langauge (MBCL)</h3>
        <p style="font-size: large">
          JSON-based technical language for compiled online math courses.
          <a href="doc/mbcl.html" target="_blank">Documentation</a>
        </p>

        <h3>Simulator Guide</h3>
        <p style="font-size: large">
          Mathe:Buddy simulator installation guide.
          <a href="doc/sim.html" target="_blank">Documentation</a>
        </p>
      </div>
    </div>

    <!-- ===== MATH RUNTIME ===== -->

    <div id="math-runtime" class="container" style="display: none">
      <div class="row">
        <h2>Math-Runtime</h2>
        <p>
          "Math Runtime" is used as math engine in the <i>mathe:buddy</i> app.
          It is entirely written in the <i>Dart</i> programming language and has
          no dependencies.
        </p>
        <b>Currently implemented grammar</b>
        <pre><code id="math-runtime-grammar"></code></pre>
      </div>

      <div class="row">
        <h4>Robust Parsing of Student Input</h4>
        <input type="text" id="student-term" class="u-full-width" />
        <button id="runParser" type="button">run</button>
        <br />
      </div>

      <div class="row">
        <b>Tokens:</b>&nbsp;
        <div id="tokens">(empty)</div>
      </div>

      <div class="row" style="padding-top: 5px">
        <b>Parsed Term / Error(s):</b>&nbsp;
        <div id="term">(empty)</div>
      </div>

      <br />

      <div class="row">
        <h4>Numerical Evaluation of Terms</h4>
        <input type="text" id="term-eval" class="u-full-width" />
        <button id="runEval" type="button">run</button>
        <br />
      </div>

      <div class="row">
        <b>Output:</b>&nbsp;
        <div id="eval-output">(empty)</div>
      </div>

      <br />

      <div class="row">
        <h4>Term Optimization</h4>
        <input type="text" id="term-opt" class="u-full-width" />
        <button id="runOpt" type="button">run</button>
        <br />
      </div>

      <div class="row">
        <b>Output:</b>&nbsp;
        <div id="opt-output">(empty)</div>
      </div>

      <br />

      <div class="row">
        <h4>Automatic Differentiation</h4>
        Term:
        <input type="text" id="term-diff" class="u-full-width" />
        Variable:
        <input type="text" id="term-diff-var" class="u-full-width" />
        <button id="runDiff" type="button">run</button>
        <br />
      </div>

      <div class="row">
        <b>Output:</b>&nbsp;
        <div id="diff-output">(empty)</div>
      </div>

      <br />

      <div class="row">
        <h4>Equivalency of Terms</h4>
        First Term:
        <input type="text" id="term-compare-first" class="u-full-width" />
        Second Term:
        <input type="text" id="term-compare-second" class="u-full-width" />
        <button id="runCompare" type="button">run</button>
        <br />
      </div>

      <div class="row">
        <b>Output:</b>&nbsp;
        <div id="compare-output">(empty)</div>
      </div>

      <br />
    </div>

    <!-- ===== SMPL ===== -->

    <div id="smpl" class="container" style="display: none">
      <div class="row">
        <h2>SMPL</h2>
        <p>
          SMPL is a math-oriented programming language that can be interpreted
          in the browser. It is entirely written in the <i>Dart</i> programming
          language and has no dependencies, except "math-runtime".
        </p>
        <p>
          More examples can be found in
          <a href="https://github.com/mathebuddy/mathebuddy-public-courses"
            >https://github.com/mathebuddy/mathebuddy-public-courses</a
          >
          (consider @code parts).
        </p>
        <b>Currently implemented grammar</b>
        (math-runtime grammar is not listed here)
        <pre><code id="smpl-grammar"></code></pre>
      </div>

      <div class="row">
        <h4>Source Code</h4>
        <textarea
          id="smpl-editor"
          class="u-full-width"
          style="width: 100%; min-height: 150px"
          spellcheck="false"
        ></textarea>
        <button id="runSmpl" type="button">run</button>
        <br />
      </div>

      <br />

      <div class="row">
        <h2>Output</h2>
        <div id="smpl-output">(empty)</div>
      </div>

      <br />

      <div class="row">
        <h2>Intermediate Code</h2>
        <div id="smpl-ic">(empty)</div>
      </div>
    </div>

    <!-- ===== MBL ===== -->

    <div id="mbl" class="container" style="display: none">
      <div class="row">
        <h2>MBL</h2>
        <p>
          TODO: TEXT!!! "Math Runtime" is used as math engine in the
          <i>mathe:buddy</i> app. It is entirely written in the
          <i>Dart</i> programming language and has no dependencies.
        </p>
      </div>
    </div>

    <div class="container">
      <br />
      <br />
      <p style="color: #767676">
        &copy; 2022-<span id="current-year"></span> Prof. Dr. Heiko Knospe,
        Patricia Maria Graf M.Sc.,
        <a href="https://www.th-koeln.de/personen/andreas.schwenk/"
          >Andreas Schwenk M.Sc.</a
        >, TH Köln.
      </p>

      <a href="https://www.th-koeln.de">
        <img
          src="img/misc/logo-th-koeln.png"
          class=""
          alt="Responsive image"
          style="height: 48px"
      /></a>
      &nbsp; &nbsp;
      <a href="https://stiftung-hochschullehre.de">
        <img
          src="img/misc/logo_stiftung_hochschullehre.png"
          class=""
          alt="Responsive image"
          style="height: 48px"
      /></a>
      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
      <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">
        <img
          src="img/misc/gpl-v3-logo.svg"
          class=""
          alt="Responsive image"
          style="height: 48px"
        />
      </a>

      <br />
    </div>

    <script>
      // TODO: add everything form here to src/ as Dart code
      let fs = {};
      let fetchedFs = false;

      let simPath = [];
      let simURL = "";

      let simBaseDir = "demo/";
      function showSim(loc) {
        let src = window.location.host.includes("localhost")
          ? "sim/index.html"
          : "sim/index-github.html";
        simURL = src;
        //resetSim();
        document.getElementById("sim").style.display = "block";
        simBaseDir = loc == "demo" ? "demo/" : "http://localhost:8271/";
        useFsJson = loc == "demo";
        fetchedFs = false;
        updateSimPathButtons();
      }

      function resetSim() {
        document.getElementById("sim-iframe").src = simURL;
        setTimeout(() => {
          document
            .getElementById("sim-iframe")
            .contentWindow.postMessage("my message");
        }, 500);
      }

      async function readTextFile(path) {
        const response = await fetch(path + "?version=" + Date.now());
        if (response.ok == false) return []; // ERROR
        let text = await response.text();
        return text;
      }

      async function getFiles(_useFsJson, path) {
        if (_useFsJson) {
          if (fetchedFs == false) {
            const response = await fetch(
              path + "_fs.json" + "?version=" + Date.now()
            );
            if (response.ok == false) return []; // ERROR
            fs = await response.json();
            fetchedFs = true;
          }
          return fs[path].sort();
        } else {
          // directory listing
          const response = await fetch(path);
          if (response.ok == false) return []; // ERROR
          let y = await response.text();
          return extractFilesFromDirectoryListingHtml(y);
        }
      }
      //getFiles(true, "demo/").then((files) => console.log(files));
      //getFiles(false, "demo/").then((files) => console.log(files));

      function updateSimPathButtonsCore(files) {
        let simPathButtons = document.getElementById("sim-path-buttons");
        simPathButtons.innerHTML = "";
        for (let file of files) {
          let button = document.createElement("button");
          button.classList.add("button");
          button.innerHTML = file;
          simPathButtons.appendChild(button);
          let span = document.createElement("span");
          span.innerHTML = "&nbsp;";
          simPathButtons.appendChild(span);
          button.onclick = function (event) {
            if (file == "..") simPath.pop();
            else simPath.push(file);
            updateSimPath();
            updateSimPathButtons();
          };
        }
      }

      function updateSimPathButtons() {
        let p = simBaseDir + simPath.join("/");
        //console.log("LOADING FILE: " + p);
        if (simPath.length == 0 || simPath[simPath.length - 1].endsWith("/")) {
          getFiles(useFsJson, p).then((files) => {
            // only keep directories and .mbl files
            let _files = [];
            for (let file of files) {
              if (file.endsWith(".mbl") || file.endsWith("/"))
                _files.push(file);
            }
            files = _files;
            //console.log("files:");
            //console.log(files);
            // add dir-up button
            if (simPath.length > 0 && files.includes("..") == false) {
              files.unshift("..");
            }
            // create buttons
            updateSimPathButtonsCore(files);
          });
        } else if (
          simPath.length > 0 &&
          simPath[simPath.length - 1].endsWith(".mbl")
        ) {
          readTextFile(p).then((text) => {
            updateSimPathButtonsCore(simPath.length > 0 ? [".."] : []);
            document.getElementById("sim-log-area").innerHTML =
              "MBL Code:<br/>" + "<pre><code>" + text + "</code></pre>";
          });
        }
        // TODO: reactive localhost not available error!

        /*fetch(p)
          .then((response) => response.text())
          .then((data) => {
            console.log(data);
            let files = [];
            if (
              simPath.length == 0 ||
              simPath[simPath.length - 1].endsWith("/")
            ) {
              files = extractFilesFromDirectoryListingHtml(data);
            } else if (
              simPath.length > 0 &&
              simPath[simPath.length - 1].endsWith(".mbl")
            ) {
              document.getElementById("sim-log-area").innerHTML =
                "<pre><code>" + data + "</code></pre>";
            }
            if (simPath.length > 0) {
              files.unshift("..");
            }
            let simPathButtons = document.getElementById("sim-path-buttons");
            simPathButtons.innerHTML =
              '<span style="color: gray"></span> &nbsp;';
            for (let file of files) {
              let button = document.createElement("button");
              button.classList.add("button");
              button.innerHTML = file;
              simPathButtons.appendChild(button);
              let span = document.createElement("span");
              span.innerHTML = "&nbsp;";
              simPathButtons.appendChild(span);
              button.onclick = function (event) {
                if (file == "..") simPath.pop();
                else simPath.push(file);
                updateSimPath();
                updateSimPathButtons();
              };
            }
          })
          .catch((error) => {
            console.log(error);
            document.getElementById("localhost-error-info").style.display =
              "block";
          });*/
      }

      function updateSimPath() {
        let e = document.getElementById("sim-current-path");
        let html = "";
        for (let i = 0; i < simPath.length; i++) {
          html += "&raquo; " + simPath[i].replace("/", "") + " ";
        }
        html += "<br/>";
        e.innerHTML = html;
      }

      function extractFilesFromDirectoryListingHtml(data) {
        let files = [];
        let lines = data.split("\n");
        for (let line of lines) {
          if (line.startsWith('<li><a href="')) {
            let file = line.substring(13).split('"')[0];
            if (file.startsWith(".")) continue;
            //if (!file.endsWith("/") && !file.endsWith(".mbl")) continue;
            files.push(file);
          }
        }
        //console.log(files);
        return files.sort();
      }

      function setDevice(id) {
        let width = 360;
        let height = 640;
        switch (id) {
          case "iPhone5s":
            width = 308;
            height = 480;
            break;
          case "iPhone8":
            // default; no change
            break;
          default:
            console.log("Error: unknown device " + id);
        }
        const div = document.getElementById("sim-iframe");
        div.style.minWidth = width + "px";
        div.style.maxWidth = width + "px";
        div.style.width = width + "px";
        div.style.minHeight = height + "px";
        div.style.maxHeight = height + "px";
        div.style.height = height + "px";
      }

      // div selection
      function show(id) {
        document.getElementById("sim").style.display = "none";
        showPlayground(""); // disable active playground
        let divs = [
          "home",
          "blog",
          "doc",
          "playground-list",
          "math-runtime",
          "smpl",
          "mbl",
          "road",
        ];
        for (let d of divs)
          document.getElementById(d).style.display = id == d ? "block" : "none";
        document.getElementById("doc-list").style.display =
          id == "doc" ? "block" : "none";
        document.getElementById("sim-list").style.display =
          id == "sim" ? "block" : "none";
        //if (id == "sim") showSim();
      }
      show("home"); // home is default

      // documentation selection
      function showDoc(id) {
        window.open("doc/" + id + ".html", "_blank");
      }

      // playground selection
      function showPlayground(id) {
        let playgrounds = ["math-runtime", "smpl", "mbl"];
        for (let d of playgrounds)
          document.getElementById(d).style.display = id == d ? "block" : "none";
      }

      // language
      var language = "en";
      function refreshLanguage() {
        let de = document.getElementsByClassName("text-german");
        for (element of de)
          element.style.display = language == "de" ? "block" : "none";
        let en = document.getElementsByClassName("text-english");
        for (element of en)
          element.style.display = language == "en" ? "block" : "none";
      }
      function switchLanguage(id) {
        language = id;
        refreshLanguage();
      }
      switchLanguage("en"); // English is default

      // update formal grammar (read from "*-grammar")
      let element1 = document.getElementById("math-runtime-grammar");
      fetch("math-runtime-grammar.txt")
        .then((response) => response.text())
        .then((data) => (element1.innerHTML = data));
      let element2 = document.getElementById("smpl-grammar");
      fetch("smpl-grammar.txt")
        .then((response) => response.text())
        .then((data) => (element2.innerHTML = data));

      // set current year in footer
      document.getElementById("current-year").innerHTML =
        new Date().getFullYear();

      // load blog
      fetch("blog/list.txt?version=" + Date.now())
        .then((response) => response.text())
        .then((data) => updateBlogList(data));

      function updateBlogList(data) {
        let lines = data.split("\n");
        let div = document.getElementById("blog-items");
        let idx = 0;
        for (let line of lines) {
          filename = line.trim();
          if (line.length == 0) continue;

          let blogItem = document.createElement("div");
          blogItem.style.borderStyle = "solid";
          blogItem.style.borderRadius = "10px";
          blogItem.style.borderColor = "#aa322c";
          blogItem.style.padding = "10px";
          blogItem.style.fontSize = "large";
          div.appendChild(blogItem);

          div.appendChild(document.createElement("br"));

          let dateAndAuthor = document.createElement("h6");
          dateAndAuthor.id = "blog-date-and-author-" + idx;
          dateAndAuthor.style.marginBottom = "0px";
          dateAndAuthor.innerHTML = "<i>TODO: DATE AND NAME</i>";
          blogItem.appendChild(dateAndAuthor);

          let title = document.createElement("h3");
          title.id = "blog-title-" + idx;
          title.style.color = "#aa322c";
          title.innerHTML = "TODO: TITLE";
          blogItem.appendChild(title);

          let p = document.createElement("p");
          p.id = "blog-text-" + idx;
          p.innerHTML = "TODO: text";
          blogItem.appendChild(p);

          let _idx = idx;
          fetch("blog/" + filename + "?version=" + Date.now())
            .then((response) => response.text())
            .then((data) => updateBlogItem(_idx, data));

          idx++;
        }

        function updateBlogItem(idx, src) {
          let date = "";
          let title = "";
          let authorName = "";
          let authorUrl = "";
          let imgPath = "";
          let lines = src.split("\n");
          for (let line of lines) {
            if (line.startsWith("<!--date="))
              date = line.substring(9, line.length - 3);
            else if (line.startsWith("<!--title="))
              title = line.substring(10, line.length - 3);
            else if (line.startsWith("<!--author-name="))
              authorName = line.substring(16, line.length - 3);
            else if (line.startsWith("<!--author-url="))
              authorUrl = line.substring(15, line.length - 3);
            else if (line.startsWith("<!--img="))
              imgPath = "blog/img/" + line.substring(8, line.length - 3);
          }
          let author = authorName;
          if (authorUrl.length > 0)
            author =
              '<a href="' + authorUrl + '" target="_blank">' + author + "</a>";
          document.getElementById("blog-date-and-author-" + idx).innerHTML =
            date + " " + author;
          document.getElementById("blog-title-" + idx).innerHTML = title;
          if (imgPath.length > 0) {
            src +=
              '<br/><br/><img class="u-max-full-width" src="' + imgPath + '"/>';
          }
          document.getElementById("blog-text-" + idx).innerHTML = src;
          refreshLanguage();
        }
      }
    </script>

    <script src="index.min.js?version=1676631568"></script>
  </body>
</html>
